#!/bin/bash
set -e

SETUP_DIR="/usr/local/bin/setup"

# Color codes
CYAN='\033[1;36m'
GREEN='\033[1;32m'
RESET='\033[0m'

printf "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
printf "${CYAN}Running setup-git.sh...${RESET}\n"
printf "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
bash "$SETUP_DIR/shell/setup-git.sh"

printf "\n${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
printf "${CYAN}Running setup-gh.sh...${RESET}\n"
printf "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
bash "$SETUP_DIR/shell/setup-gh.sh"

printf "\n${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
printf "${CYAN}Setting up skills...${RESET}\n"
printf "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"

# Create .claude directory if it doesn't exist
mkdir -p /home/agent/.claude/skills

# Check if skills directory is empty or doesn't exist
if [ -z "$(ls -A /home/agent/.claude/skills 2>/dev/null)" ]; then
    printf "${CYAN}No skills found in /home/agent/.claude/skills, copying default skills...${RESET}\n"
    cp -r "$SETUP_DIR/skills/"* /home/agent/.claude/skills/
    printf "${GREEN}✓ Default skills copied successfully${RESET}\n"
else
    printf "${GREEN}✓ Skills already present in /home/agent/.claude/skills${RESET}\n"
fi

printf "\n${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
printf "${CYAN}Running setup-repo.py...${RESET}\n"
printf "${CYAN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
python3 "$SETUP_DIR/python/setup-repo.py"

printf "\n${GREEN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
printf "${GREEN}✓ All setup scripts completed successfully${RESET}\n"
printf "${GREEN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}\n"
exec "$@"
